name: nvc build

on:
  push:
    branches: [ "master", "merge_openacc" ]
    paths-ignore:
      - '**/README.md'
  pull_request:
    branches: [ "master" ]
    paths-ignore:
      - '**/README.md'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: get nvidia hpc-sdk
      run: |
        # curl https://developer.download.nvidia.com/hpc-sdk/ubuntu/DEB-GPG-KEY-NVIDIA-HPC-SDK | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-hpcsdk-archive-keyring.gpg
        # echo 'deb [signed-by=/usr/share/keyrings/nvidia-hpcsdk-archive-keyring.gpg] https://developer.download.nvidia.com/hpc-sdk/ubuntu/amd64 /' | sudo tee /etc/apt/sources.list.d/nvhpc.list
        # sudo apt-get update -y
        # sudo apt-get install -y nvhpc-23-9
        echo $PATH
        PATH=$PATH:/opt/nvidia/hpc_sdk/Linux_x86_64/23.9/compilers/bin
        export PATH
        echo $PATH
    - name: get boost
      run: sudo apt install libboost-program-options-dev
    - name: make 2d with nvidia profiling tools
      run: make clean; make ndims=2 nprof=1
    - name: make 3d with nvidia profiling tools
      run: make clean; make ndims=3 nprof=1
      
